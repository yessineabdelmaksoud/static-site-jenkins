pipeline {
    agent any

    stages {
        stage('Checkout') {
            steps {
                echo 'Code déjà récupéré depuis Git par Jenkins (SCM).'
            }
        }

        stage('Build') {
            steps {
                echo 'Aucune étape de build nécessaire pour un site statique.'
            }
        }

        stage('Test') {
            steps {
                echo 'Vérification que les fichiers statiques existent...'
                bat '''
                if not exist index.html (
                    echo ERREUR : index.html est manquant !
                    exit /b 1
                )
                if not exist style.css (
                    echo ERREUR : style.css est manquant !
                    exit /b 1
                )
                echo OK : index.html et style.css sont présents.
                '''
            }
        }

        stage('Package') {
            steps {
                echo 'Préparation du dossier deploy/...'
                bat '''
                if exist deploy rmdir /S /Q deploy
                mkdir deploy
                xcopy index.html deploy /Y
                xcopy style.css deploy /Y
                '''
            }
        }

        stage('Deploy') {
            steps {
                echo 'Déploiement vers le dossier local...'
                bat '''
                if not exist C:\\jenkins-deploy\\static-site (
                    mkdir C:\\jenkins-deploy\\static-site
                )
                xcopy deploy\\* C:\\jenkins-deploy\\static-site /E /I /Y
                echo Site déployé dans C:\\jenkins-deploy\\static-site
                '''
            }
        }
    }

    post {
        success {
            echo 'Pipeline terminé avec succès.'
            archiveArtifacts artifacts: 'deploy/**', fingerprint: true
        }
        failure {
            echo 'Le pipeline a échoué.'
        }
    }
}
